<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Muchacho</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
      body {
        font-family: helvetica;
      }

      .target {
        width: 200px;
        height: 133px;
        background-color: gray;
      }

      .success {
        background-color: green;
      }

      .failure {
        background-color: red;
      }

      .VideoThumbnail {
        width: 200px;
        height: 133px;
      }

      .dirty {
        color: red;
      }

    </style>
  </head>
  <body>
    <h1>Muchacho</h1>

    <div id="drag-target" class="target" ondrop="handleChange(event)" ondragover="handleDragover(event)">
      Drag and drop a YouTube video from <a href="https://www.youtube.com/feed/history">your history</a> here to add it to the cache.
    </div>

    <script type="text/babel" src="static/index.jsx"></script>
    <div id="app"></div>

    <script>
      function handleDragover(event) {
        // console.debug(event);
        event.preventDefault();
      }

      function handleChange(event) {
        // console.debug(event);
        event.preventDefault();
        const url = event.dataTransfer.getData("text");
        console.debug("url", url);

        const params = {
          method: "POST",
          body: JSON.stringify({"url": url}),
          headers: {"Content-Type": "application/json"},
        };
        const target = document.querySelector("#drag-target");
        fetch("/videos", params)
          .then(response => {
            target.classList.add("success");
            setTimeout(() => target.classList.remove("success"), 1000);
          })
          .catch(error => {
            console.debug("error", error);
            target.classList.add("failure");
            setTimeout(() => target.classList.remove("failure"), 1000);
          });
      }
    </script>
  </body>
</html>
